open Three_address_code__IR
open Ssa__Optim

let test =
  Basic_block.create "test" ~source:
    { entry = "";
      exits = [];
      stmts = List.map ref [
          Move (Var "t_0", Const 5);
          Move (Var "x_0", Binop (Minus, Val (Var "t_0"), Const 4));
          Move (Var "t_1", Binop (Plus, Val (Var "x_0"), Val (Var "t_0")));
          Move (Var "z_0", Binop (Minus, Val (Var "t_1"), Const 1));
          Return (Some (Val (Var "z_0")));
        ]
    }

let print text =
  print_endline text;
  print_endline (Basic_block.to_string test)

let () =
  print "Before optimization:";
  print_newline ();
  optimize test ~dump:true;
  print "After optimization:"
