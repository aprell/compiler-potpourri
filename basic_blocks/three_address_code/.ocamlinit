open Three_address_code__IR
open Three_address_code__Parse

let src = {|
  test() {
      a := 1 + 2 * 3 - 4
      b := a / a - 2
      c := 3 - b * 2
      d := c * 2 / 3 + 4
      a := a + d - 2 - 2 + 1
      f := a - a + g
      g := f * 2 / 2
      h := h * 1
      i := n + 5
      j := i - 2
      return j
  }
|}

let print ~text block =
  print_endline text;
  dump block;
  print_newline ()

let () =
  let stmts = snd @@ parse_prog src in
  print ~text:"After first peephole optimization:" stmts;
  print ~text:"After second peephole optimization:" (peephole stmts)
